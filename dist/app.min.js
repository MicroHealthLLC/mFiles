angular.module("config",[]).value("config",{debug:!0,limit:10,peerIdLength:6,fileIdLength:4,chunkSize:15e3,chunksPerBlock:64,peerConfig:{host:"peer.microhealthllc.com",path:"/signaling",port:9100,key:"reepio",config:{iceServers:[{url:"stun:1.1.1.1"}]}}}),function(){"use strict";var a=["config","ngAnimate","ngRoute","upload","static","download","titleController","common","angulartics","angulartics.piwik","reepIoLogoModule"];angular.module("peertome",a,["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|filesystem|blob):/),a.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|filesystem|blob):|data:image\//)}]).constant("appEnv","undefined"!=typeof window.app_env?window.app_env:"prod").config(["$routeProvider","$locationProvider","$analyticsProvider","appEnv",function(a,b,c,d){a.otherwise({templateUrl:"modules/static/page-404.html",controller:"StaticCtrl"}),b.html5Mode("dev"!==d),c.virtualPageviews(!1)}]).value("clipboardSwf","/assets/bower_components/reepio-paste-to-clipboard/bin/CopyToClipboard.swf").value("clipboardExpressInstallSwf","/assets/bower_components/reepio-paste-to-clipboard/bin/expressInstall.swf").run(["$rootScope","$location","$route","$document","appEnv",function(a,b,c,d,e){a.appEnv=e,angular.element("#navbar-collapse-1").collapse({toggle:!1}),angular.element("#socialshareprivacy").length>0&&$("#socialshareprivacy").socialSharePrivacy({services:{facebook:{perma_option:"off",dummy_img:"assets/js/socialshareprivacy/images/dummy_facebook_en.png",img:"assets/js/socialshareprivacy/images/facebook.png",sharer:{status:"on",dummy_img:"assets/js/socialshareprivacy/images/dummy_facebook_share_en.png",img:"assets/js/socialshareprivacy/images/facebook_share_en.png"}},twitter:{perma_option:"off",dummy_img:"assets/js/socialshareprivacy/images/dummy_twitter.png",img:"assets/js/socialshareprivacy/images/twitter.png"},gplus:{perma_option:"off",dummy_img:"assets/js/socialshareprivacy/images/dummy_gplus.png",img:"assets/js/socialshareprivacy/images/gplus.png"}},css_path:"",lang_path:"assets/js/socialshareprivacy/lang/",language:"en",uri:"https://reep.io",perma_orientation:"top"}),a.view_Load=function(){angular.element("#navbar-collapse-1").collapse("hide")},a.getIsPageActive=function(c){return"/d"===c?b.path()===c+"/"+a.downloadId:b.path()===c},a.running=!0}])}(),angular.module("reepioClipboard",["reepioClipboardDirective"]),function(){"use strict";angular.module("common",[])}(),function(){"use strict";angular.module("download",["ngRoute","stringFilters","fileIcon","progressBar","ui.bootstrap","common"])}(),function(){"use strict";angular.module("static",["ngRoute"])}(),function(){"use strict";angular.module("upload",["fileIcon","progressBar","ui.bootstrap","common","peering","reepioClipboard"])}(),angular.module("reepioClipboardDirective",[]).value("clipboardSwf","CopyToClipboard.swf").value("clipboardExpressInstallSwf","expressInstall.swf").config(function(){swfobject.switchOffAutoHideShow()}).service("clipboardDirectiveIdService",[function(){return{__id:0,getUniqueId:function(){return"clipboard-"+this.__id++}}}]).directive("reepioClipboard",["$compile","clipboardDirectiveIdService","converterService","clipboardSwf","clipboardExpressInstallSwf",function(a,b,c,d,e){var f={menu:"false",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"};return window.clipboard={ready:!1,loaded:function(a){window.clipboard.ready=!0;var b=angular.element("#"+a),c=b.scope();b.get(0).setClipboardData(c.data)},copied:function(a){var b=angular.element("#"+a),c=b.scope();c.onCopied&&c.onCopied(b.parents(".btn-clipboard"))}},{restrict:"EA",transclude:!0,scope:{data:"=clipboardData",onCopied:"=?"},template:'<div class="btn-clipboard"><span ng-transclude></span></div>',link:function(g,h,i){g.id=b.getUniqueId();var j='<div id="'+g.id+'"></div>',k=a(j)(g);if(h.find(".btn-clipboard").prepend(k),"undefined"==typeof swfobject)throw new Error("swfobject is required");var l,m,n,o;m=h.find(".btn-clipboard").css("background-color"),n={data:g.data,bgcolor:"0x"+c.rgb2hex(m),id:g.id},o={id:g.id},swfobject.embedSWF(d,g.id,"100%","100%","10.0.0",e,n,f,o,function(a){if(!a.success)throw h.remove(),new Error("Could not initialize "+d);l=document.getElementById(a.id)}),g.$watch("data",function(a){"undefined"!=typeof a&&h.setClipboardData&&h.setClipboardData(a)}),setTimeout(function(){window.clipboard.ready||(h.remove(),l.remove())},300)}}}]),function(){"use strict";angular.module("common").factory("converterService",function(){return{rgb2hex:function(a){return a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),a&&4===a.length?("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""}}})}(),function(){"use strict";angular.module("common").service("$crypto",function(){var a=function(){var a=function(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b};this.crc32=function(b){if(null===b||""===b)return null;for(var c=window.crcTable||(window.crcTable=a()),d=-1,e=0;e<b.length;e++)d=d>>>8^c[255&(d^b.charCodeAt(e))];return((-1^d)>>>0).toString(16).toUpperCase()}};return new a})}(),function(){angular.module("common").service("detectCrawlerService",[function(){this.regex="(bot|borg|google(^tv)|mediapartners(\\s|\\-\\(?google.*)|yahoo|slurp|msnbot|bingbot|adidxbot|bingpreview|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks|Prerender|duckduckbot)",this.isCrawler=function(a){if("string"!=typeof a)return!1;if(a=a.trim(),!a)return!1;var b=a.toLowerCase().match(this.regex);return b?!0:!1}}])}(),function(){"use strict";angular.module("common").controller("DialogController",["$scope","$element","$rootScope",function(a,b,c){c.muteDialogs=!1,c.$on("error",function(b,c,d){a.title=c,a.message=d,a.visible=!0}),c.showDialog=function(b,c){a.title=b,a.message=c,a.visible=!0},a.$watch("visible",function(a){"undefined"!=typeof a&&c.muteDialogs!==!0&&b.modal({show:a})}),c.$watch("muteDialogs",function(a){"undefined"!=typeof a&&a===!0&&b.modal({show:!1})})}])}(),function(){"use strict";var a={"image/jpeg":"fa-file-image-o","image/png":"fa-file-image-o","image/gif":"fa-file-image-o","image/jpg":"fa-file-image-o","image/bmp":"fa-file-image-o","image/tiff":"fa-file-image-o","application/pdf":"fa-file-pdf-o","application/x-zip-compressed":"fa-file-zip-o","application/x-gzip":"fa-file-zip-o","application/x-tar":"fa-file-zip-o","application/javascript":"fa-file-code-o","text/xml":"fa-file-code-o","text/html":"fa-file-code-o","text/css":"fa-file-code-o","text/plain":"fa-file-text-o","text/rtf":"fa-file-text-o","application/vnd.oasis.opendocument.text":"fa-file-word-o","audio/mpeg":"fa-file-audio-o","video/x-flv":"fa-file-video-o","video/mpeg":"fa-file-video-o","video/quicktime":"fa-file-video-o","video/mp4":"fa-file-video-o","video/x-msvideo":"fa-file-video-o","video/x-ms-wmv":"fa-file-video-o","video/webm":"fa-file-video-o","video/avi":"fa-file-video-o"};angular.module("fileIcon",[]).directive("p2mFileIcon",function(){return{restrict:"EA",scope:{fileType:"=","class":"@?class"},template:'<div class="file-icon {{ class }}"><span class="fa {{ iconType }}"></span></div>',link:function(b,c,d){b["class"]=d["class"]||"file-icon-default",b.$watch("fileType",function(c){return"undefined"!=typeof a[c]?void(b.iconType=a[c]):void(b.iconType="fa-file-o")})}}})}(),function(){"use strict";angular.module("progressBar",["fileFilters"]).directive("p2mProgressBar",function(){return{restrict:"EA",scope:{progress:"=percent",speed:"=?",showProgress:"=?"},template:'<div class="p2m-progress-bar" ng-class="{\'p2m-progress-bar-no-progress\': ! showProgress }"><div class="progress"><div class="progress-inner" style="width: {{ progress }}%"></div></div><ul class="progress-meta" ng-show="progress && showProgress"><li>{{ progress|number:1 }}%</li><li ng-show="progress > 0 && speed"><span ng-show="speed">{{ speed|humanFileSize }}/s</span></li></ul></div>'}})}(),function(){"use strict";angular.module("reepIoLogoModule",[]).directive("reepIoLogo",function(){return{restrict:"EA",scope:{width:"=?",height:"=?"},link:function(a,b){function c(){f=document.createElement("div"),$(b).append(f),g=new THREE.PerspectiveCamera(20,k/l,1,1e3),g.position.y=150,g.position.z=220,h=new THREE.Scene;for(var a=20,c=new THREE.BoxGeometry(a,a,a),d=12395042,e=0;e<c.faces.length;e+=2)c.faces[e].color.setHex(d),c.faces[e+1].color.setHex(d);var m=new THREE.MeshLambertMaterial({vertexColors:THREE.FaceColors,overdraw:.15});j=new THREE.Mesh(c,m),j.position.y=150,j.rotation.y=45*Math.PI/180,j.rotation.x=45*Math.PI/180,h.add(j);var n=new THREE.DirectionalLight(16777215,2);n.position.set(0,2,2),n.target.position.set(0,0,0),h.add(n),i=window.WebGLRenderingContext?new THREE.WebGLRenderer({antialias:!0,precision:"lowp"}):new THREE.CanvasRenderer,i.setClearColor(16777215),i.setSize(k,l),f.appendChild(i.domElement)}function d(){requestAnimationFrame(d),e()}function e(){0>=m?(n="x"==n?"y":"y"==n?"z":"x",m=45*Math.PI/180):(j.rotation[n]+=.003,m-=.003),i.render(h,g)}var f,g,h,i,j,k=a.width||150,l=a.height||75,m=90*Math.PI/180,n="x";c(),d()}}})}(),function(){"use strict";angular.module("fileFilters",[]).filter("humanFileSize",function(){var a=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];return function(b,c){if(angular.isNumber(b)===!1)return b;if(angular.isNumber(c)===!1&&(c=2),1024>=b)return b+a[0];var d=0;do b/=1024,d++;while(b>=1024);return b.toFixed(c)+" "+a[d]}})}(),function(){"use strict";angular.module("stringFilters",[]).filter("maxLength",function(){return function(a,b){return a?(angular.isString(a)||(a=a.toString()),b=b||10,a.length>b?a.substr(0,b)+"...":a):""}})}(),function(){"use strict";angular.module("common").controller("LoadingCtrl",["$scope","$element",function(a,b){a.indicator="...";var c=b.find(".loading-screen-inner .text-primary"),d=setInterval(function(){a.$apply(function(){1==c.css("opacity")?c.css("opacity",.2):c.css("opacity",1)})},500);a.$on("$destroy",function(a){clearInterval(d)})}])}(),function(){"use strict";angular.module("common").directive("notifications-modal-dialog",[function(){return{restrict:"E",template:'<div class="modal fade">	<div class="modal-dialog">		<div class="modal-content">			<div class="modal-header">				<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>				<h4 class="modal-title">Modal title</h4>			</div>			<div class="modal-body">				<p>One fine body&hellip;</p>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>				<button type="button" class="btn btn-primary">Save changes</button>			</div>		</div>	</div></div>',scope:{title:"=",message:"="},link:function(a,b,c){}}}]).service("$dialog",["$compile",function(a){var b=function(){this.show=function(b,c){var d={title:b,message:c},e=angular.element(document.createElement("notifications-modal-dialog")),f=a(e),g=f(d);angular.element(document.body).append(g)},this.hide=function(){},this.mute=function(){},this.unmute=function(){}};return new b}]).run(["$templateCache",function(a){a.put("/default-dialog.html",'<div class="modal fade">	{{ title }}</div>')}])}(),function(){angular.module("common").service("randomService",[function(){this.defaultLength=6,this.generateString=function(a){a||(a=this.defaultLength);for(var b="",c="abcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}}])}(),function(){"use strict";angular.module("download").config(["$routeProvider",function(a){a.when("/d/:id",{templateUrl:"modules/download/download.html",controller:"DownloadCtrl"})}]).controller("DownloadCtrl",["$scope","$rootScope","$route","$timeout","$location","$analytics","$crypto","config","downloadService","detectCrawlerService",function(a,b,c,d,e,f,g,h,i,j){if("undefined"==typeof b.downloadId&&(b.downloadId=c.current.params.id,b.cryptoDownloadId=g.crc32(c.current.params.id),b.downloadService=i),f.pageTrack("/d/"+b.cryptoDownloadId),!j.isCrawler(navigator.userAgent)&&!util.supports.data)return void e.path("incompatible");a.isImage=!1,b.downloadId.length==h.peerIdLength+h.fileIdLength?i.requestFileInformation(b.downloadId):(a.downloadError="Invalid Download",a.downloadErrorDescription="The download link you are using is invalid."),a.downloadFile=function(){i.startDownload()},a.startStream=function(){i.startStream()},a.getIsDownloadVisible=function(){return!a.downloadError&&-1!==["ready","inprogress","paused","finished","datachannelClosed"].indexOf(b.downloadService.downloadState)},a.saveFile=function(){d(function(){$("#download-frame").get(0).click()})},a.doAuthentication=function(){i.doAuthentication(a.password)};var k=[b.$on("DownloadFinished",function(b){d(function(){a.$apply(function(){if(a.isImage);else{var b=$("#download-frame");b.length>0&&b.get(0).click()}})}),f.eventTrack("startDownload",{category:"download",value:Math.round(i.file.size/1024)})}),b.$on("FileInformation",function(b,c){d(function(){a.$apply()})}),b.$on("intervalCalculations",function(b){d(function(){a.$apply()})}),b.$on("AuthenticationRequest",function(b){d(function(){a.$apply()})}),b.$on("IncorrectPassword",function(b){d(function(){a.$apply(function(){a.authenticationError="Invalid credentials. Please enter the correct password"})})}),b.$on("DownloadDataChannelClose",function(){"finished"!=b.downloadService.downloadState&&a.isStreamingRunning===!1&&d(function(){a.$apply(function(){a.downloadError="The uploader has closed the connection",a.downloadErrorDescription="You cannot download this file anymore because the connection to the uploader is closed."})})}),b.$on("NoFileSystem",function(){d(function(){a.$apply()})})];a.$on("$destroy",function(){angular.forEach(k,function(a){a()})})}])}(),function(){angular.module("download").service("downloadService",["config","$q","peeringService","randomService","$rootScope","storageService",function(a,b,c,d,e,f){this.id=null,this.connection=null,this.file={name:"",type:"",size:0,totalChunksToReceive:0,chunksReceived:0,chunksOfCurrentBlockReceived:0,downloadedChunksSinceLastCalculate:0,progress:0,noFileSystem:!1,isStreamAble:!1},this.streamBuffer=[],this.isStream=!1,this.isStreamingRunning=!1,this.intervalProgress=null,this.downloadState="connecting",e.$emit("DownloadStateChanged",this.downloadState),this.requestFileInformation=function(a){null===this.id&&(this.id=this.parseId(a),c.getPeer().then(function(a){this.connection=a.connect(this.id.uploaderId,{reliable:!0}),this.connection.on("close",function(a){e.$emit("DownloadDataChannelClose")}),this.connection.on("data",function(a){if(a instanceof ArrayBuffer)return void this.__onPacketFileData(a);var b=this["__onPacket"+a.packet];"function"==typeof b&&(b=b.bind(this))(a)}.bind(this)),this.connection.on("open",function(){0==this.file.name.length&&this.connection.send({packet:"RequestFileInformation",fileId:this.id.fileId})}.bind(this)),this.connection.on("error",function(a){e.$emit("DownloadDataChannelClose")}),a.on("error",function(a){e.$emit("DownloadDataChannelClose")})}.bind(this)))},this.parseId=function(b){return b.hasOwnProperty("uploaderId")?b:{uploaderId:b.substring(0,a.peerIdLength),fileId:b.substring(a.peerIdLength,a.peerIdLength+a.fileIdLength)}},this.startDownload=function(){if(0!=this.file.name.length){this.downloadState="inprogress",e.$emit("DownloadStateChanged",this.downloadState),this.intervalProgress=setInterval(this.progressCalculations.bind(this),1e3);var a=this;f.getStorageForFile(this.file.name,this.file.size).then(function(b){this.file.fileIdentifier=b;var c=f.getFileEntry(b);return a.isStream&&void 0!==c?void c.file(function(b){var c=new FileReader;c.onloadend=function(b){a.appendChunkToStream(this.result),a.requestBlock(a.file.chunksReceived)},c.readAsArrayBuffer(b)},function(){}):void this.requestBlock(this.file.chunksReceived)}.bind(this),function(a){this.file.fileIdentifier=a,this.file.noFileSystem=!0,this.requestBlock(0),e.$emit("NoFileSystem",this.file)}.bind(this))}},this.startStream=function(){this.video=document.querySelector("video"),this.mediaSource=new MediaSource,this.video.src=window.URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",function(){this.sourceBuffer=this.mediaSource.addSourceBuffer(this.getCodecToType(this.file.type)),this.startDownload(),this.sourceBuffer.addEventListener("updateend",function(a){this.streamBuffer.length>0?this.appendChunkToStream(this.streamBuffer.shift()):this.streamInterval=setInterval(function(){this.streamBuffer.length>0&&(this.appendChunkToStream(this.streamBuffer.shift()),clearInterval(this.streamInterval))}.bind(this),50)}.bind(this)),this.sourceBuffer.addEventListener("error",function(a){})}.bind(this),!1),this.mediaSource.addEventListener("error",function(a){}),this.isStreamingRunning=!0,this.isStream=!0},this.appendChunkToStream=function(a){try{this.sourceBuffer.appendBuffer(new Uint8Array(a))}catch(b){this.abortStream()}},this.abortStream=function(){this.isStream=!1,this.isStreamingRunning=!1,this.streamBuffer=[],clearInterval(this.streamInterval),e.$emit("errorPlayingStream")},this.progressCalculations=function(){this.file.bytesPerSecond=this.file.downloadedChunksSinceLastCalculate*a.chunkSize,e.$emit("intervalCalculations",this.file.bytesPerSecond,this.file.progress),this.connection.send({packet:"DownloadProgress",bytesPerSecond:this.file.bytesPerSecond,percent:this.file.progress,fileId:this.id.fileId}),this.file.downloadedChunksSinceLastCalculate=0},this.requestBlock=function(a){this.connection.send({packet:"RequestBlock",fileId:this.id.fileId,chunkPosition:a})},this.doAuthentication=function(a){this.connection.send({packet:"Authenticate",password:a,fileId:this.id.fileId})},this.isStreamAble=function(a){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,void 0===window.MediaSource?!1:MediaSource.isTypeSupported(this.getCodecToType(a))},this.getCodecToType=function(a){return"video/mp4"==a?'video/mp4; codecs="avc1.42E01E, mp4a.40.2"':"video/ogg"==a?'video/ogg; codecs="theora, vorbis"':"video/webm"==a?'video/webm; codecs="vorbis, vp8, vp9"':"No codec found"},this.__onPacketFileData=function(b){this.isStream&&(0==this.file.chunksReceived?this.appendChunkToStream(b):this.streamBuffer.push(b)),this.file.chunksReceived++,this.file.chunksOfCurrentBlockReceived++,this.file.downloadedChunksSinceLastCalculate++,this.file.progress=this.file.chunksReceived/this.file.totalChunksToReceive*100,this.file.chunksReceived!==this.file.totalChunksToReceive&&this.file.chunksOfCurrentBlockReceived%a.chunksPerBlock==0&&(this.file.chunksOfCurrentBlockReceived=0,this.requestBlock(this.file.chunksReceived)),f.addChunkToFileBuffer(this.file.fileIdentifier,b),this.file.chunksReceived==this.file.totalChunksToReceive&&f.getUrlForFinishedDownload(this.file.fileIdentifier).then(function(a){clearInterval(this.intervalProgress),this.progressCalculations(),this.file.fileSystemUrl=a,this.downloadState="finished",e.$emit("DownloadStateChanged",this.downloadState),e.$emit("DownloadFinished"),this.connection.send({packet:"DownloadFinished",fileId:this.id.fileId})}.bind(this))},this.__onPacketAuthenticationSuccessfull=function(a){e.$emit("AuthenticationSuccessfull")},this.__onPacketIncorrectPassword=function(a){e.$emit("IncorrectPassword")},this.__onPacketFileInformation=function(b){this.file.name=b.fileName,this.file.size=b.fileSize,this.file.type=b.fileType,this.file.isStreamAble=this.isStreamAble(b.fileType),this.file.totalChunksToReceive=Math.ceil(b.fileSize/a.chunkSize),this.downloadState="ready",e.$emit("DownloadStateChanged",this.downloadState),f.checkIfFileExits(b.fileName,b.fileSize).then(function(c){this.file.chunksReceived=Math.ceil(c.size/a.chunkSize),this.file.progress=this.file.chunksReceived/this.file.totalChunksToReceive*100,100==this.file.progress?f.getUrlForFinishedDownload(f.generateFileIdentifier(b.fileName,b.fileSize)).then(function(a){this.downloadState="finished",e.$emit("DownloadStateChanged",this.downloadState),this.file.fileSystemUrl=a,e.$emit("FileInformation",this.file)}.bind(this)):e.$emit("FileInformation",this.file)}.bind(this),function(){e.$emit("FileInformation",this.file)})},this.__onPacketAuthenticationRequest=function(a){this.downloadState="authentication",e.$emit("DownloadStateChanged",this.downloadState),e.$emit("AuthenticationRequest")}}])}(),function(){"use strict";angular.module("download").directive("reepioLoadingIndicator",[function(){return{restrict:"A",link:function(a,b,c){var d=c.reepioLoadingIndicatorMessage||"Loading...",e=angular.element(b);e.before('<div class="loading-indicator {{ className }}"><p><i class="fa fa-spin fa-gear"></i><br> '+d+"</p></div>"),e.on("load",function(a){e.prev().remove()})}}}])}(),function(){"use strict";angular.module("download").service("storageService",["$crypto","$q",function(a,b){this.files={},this.isFileSystemAvailable=function(){return window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,void 0!==window.requestFileSystem&&void 0!==navigator.webkitTemporaryStorage&&void 0!==navigator.webkitPersistentStorage?!0:!1},this.checkIfFileExits=function(c,d){var e=b.defer();if(!this.isFileSystemAvailable())return e.reject(),e.promise;var f=a.crc32(c+d);return void 0===this.files[f]&&this.initilizeFileObject(f),this.findFileInTemporaryStorage(f,c,d).then(function(a){this.files[f].sizeOfExistingFileTemp=a.metaData.size,this.files[f].fileSystemUrl=a.fileEntry.toURL("application/unknown"),this.files[f].fileEntry=a.fileEntry,e.resolve(a.metaData)}.bind(this),function(){this.findFileInPersitentStorage(f,c,d).then(function(a){this.files[f].sizeOfExistingFilePersitent=a.metaData.size,this.files[f].fileSystemUrl=a.fileEntry.toURL("application/unknown"),this.files[f].fileEntry=a.fileEntry,e.resolve(a.metaData)}.bind(this),function(){e.reject()})}.bind(this)),e.promise},this.findFileInTemporaryStorage=function(a,c,d){var e=b.defer();return this.requestTemporaryStorageFileSystem(d).then(function(b){this.getFile(b,a+"/"+c,{create:!1}).then(function(a){a.getMetadata(function(b){e.resolve({metaData:b,fileEntry:a})},function(){e.reject()})},function(){e.reject()})}.bind(this),function(){e.reject()}),e.promise},this.findFileInPersitentStorage=function(a,c,d){var e=b.defer();return this.getFreePersistentStorageSpace().then(function(b){b>0?this.requestPersistentStorageFileSystem(d).then(function(b){this.getFile(b,a+"/"+c,{create:!1}).then(function(a){a.getMetadata(function(b){e.resolve({metaData:b,fileEntry:a})},function(){e.reject()})},function(){e.reject()})}.bind(this),function(){e.reject()}):e.reject()}.bind(this),function(){e.reject()}),e.promise},this.initilizeFileObject=function(a){this.files[a]={},this.files[a].blockBuffer=[],this.files[a].sizeOfExistingFileTemp=0,this.files[a].sizeOfExistingFilePersitent=0},this.getStorageForFile=function(c,d){var e=b.defer(),f=a.crc32(c+d);return void 0===this.files[f]&&this.initilizeFileObject(f),this.isFileSystemAvailable()?(this.requestTemporaryStorage(f,c,d).then(function(){e.resolve(f)},function(){this.requestPersistentStorage(f,c,d).then(function(){e.resolve(f)},function(){void 0!==this.files[f].fileWriter&&delete this.files[f].fileWriter,e.reject(f)}.bind(this))}.bind(this)),e.promise):(e.resolve(f),e.promise)},this.requestTemporaryStorage=function(a,c,d){var e=b.defer();return this.requestTemporaryStorageFileSystem(d).then(function(b){this.cleanUpFilesystem(b,a).then(function(){this.getFreeTemporaryStorageSpace().then(function(f){d-this.files[a].sizeOfExistingFileTemp+100<=f?this.initializeFiles(b,a,c).then(function(){e.resolve()},function(){e.reject()}):e.reject()}.bind(this),function(){e.reject()})}.bind(this))}.bind(this),function(){e.reject()}),e.promise},this.requestTemporaryStorageFileSystem=function(a){var c=b.defer();return window.requestFileSystem(window.TEMPORARY,a+100,function(a){c.resolve(a)}.bind(this),function(){c.reject()}),c.promise},this.getFreeTemporaryStorageSpace=function(){var a=b.defer();return navigator.webkitTemporaryStorage.queryUsageAndQuota(function(b,c){var d=c-b;a.resolve(d)},function(){a.reject()}),a.promise},this.requestPersistentStorage=function(a,c,d){var e=b.defer();return this.getFreePersistentStorageSpace().then(function(b){d-this.files[a].sizeOfExistingFilePersitent+100<=b?this.requestPersistentStorageFileSystem(d).then(function(b){this.cleanUpFilesystem(b,a).then(function(){this.initializeFiles(b,a,c).then(function(){e.resolve()},function(){e.reject()})}.bind(this))}.bind(this),function(){e.reject()}):this.requestPersistentStorageQuota().then(function(){this.requestPersistentStorageFileSystem(d).then(function(b){this.cleanUpFilesystem(b,a).then(function(){this.getFreePersistentStorageSpace().then(function(f){d-this.files[a].sizeOfExistingFilePersitent+100<=f?this.initializeFiles(b,a,c).then(function(){e.resolve()},function(){e.reject()}):e.reject()}.bind(this),function(){e.reject()})}.bind(this))}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()}),e.promise},this.getFreePersistentStorageSpace=function(){var a=b.defer();return navigator.webkitPersistentStorage.queryUsageAndQuota(function(b,c){var d=c-b;a.resolve(d)},function(){a.reject()}),a.promise},this.requestPersistentStorageQuota=function(){var a=b.defer();return navigator.webkitPersistentStorage.requestQuota(107374182400,function(b){a.resolve(b)},function(){a.reject()}),a.promise},this.requestPersistentStorageFileSystem=function(a){var c=b.defer();return window.requestFileSystem(window.PERSISTENT,a+100,function(a){c.resolve(a)}.bind(this),function(){c.reject()}),c.promise},this.initializeFiles=function(a,c,d){var e=b.defer();return this.createFolder(a,c).then(function(){this.getFile(a,c+"/lockfile",{create:!0}).then(function(b){this.getFileWriter(b).then(function(b){b.truncate(0),this.files[c].lockFileInterval=setInterval(function(){b.truncate(0)},5e3),this.getFile(a,c+"/"+d,{create:!0}).then(function(a){this.getFileWriter(a).then(function(b){b.seek(b.length),this.files[c].fileWriter=b,this.files[c].fileSystemUrl=a.toURL("application/unknown"),this.files[c].fileWriterInterval=setInterval(function(){if(1!=this.files[c].fileWriter.readyState)try{this.files[c].blockBuffer.length>0&&(this.files[c].fileWriter.write(new Blob(this.files[c].blockBuffer)),delete this.files[c].blockBuffer,this.files[c].blockBuffer=[])}catch(a){}}.bind(this),3e3),e.resolve()}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()})}.bind(this),function(){e.reject()}),e.promise},this.createFolder=function(a,c){var d=b.defer();return a.root.getDirectory(c,{create:!0},function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},this.getFile=function(a,c,d){var e=b.defer();return a.root.getFile(c,d,function(a){e.resolve(a)},function(){e.reject()}),e.promise},this.getFileWriter=function(a){var c=b.defer();return a.createWriter(function(a){c.resolve(a)},function(){c.reject()}),c.promise},this.cleanUpFilesystem=function(a,c){var d=b.defer(),e=a.root.createReader();return e.readEntries(function(b){b.length>0?this.deleteEntries(b,0,a,c).then(function(){d.resolve()}):d.resolve()}.bind(this),function(){d.resolve()}),d.promise},this.deleteEntries=function(a,c,d,e){var f=b.defer();if(c>=a.length)return f.resolve(),f.promise;var g=c+1;return this.deleteEntries(a,g,d,e).then(function(){var b=a[c];if(1==b.isDirectory){if(b.name==e)return void f.resolve();d.root.getFile(b.name+"/lockfile",{create:!1},function(a){a.getMetadata(function(a){a.modificationTime.getTime()+7e3<(new Date).getTime()?b.removeRecursively(function(){f.resolve()},function(){f.resolve()}):f.resolve()},function(){f.resolve()})},function(a){b.removeRecursively(function(){f.resolve()},function(){f.resolve()})})}else f.resolve()}),f.promise},this.addChunkToFileBuffer=function(a,b){this.files[a].blockBuffer.push(b)},this.getUrlForFinishedDownload=function(a){var c=b.defer();return void 0===this.files[a].fileWriter?void 0!==this.files[a].fileSystemUrl?(c.resolve(this.files[a].fileSystemUrl),c.promise):(c.resolve(URL.createObjectURL(new Blob(this.files[a].blockBuffer))),c.promise):(clearInterval(this.files[a].fileWriterInterval),this.files[a].blockBuffer.length>0?(this.files[a].fileWriter.onwriteend=function(){c.resolve(this.files[a].fileSystemUrl)}.bind(this),this.files[a].fileWriter.write(new Blob(this.files[a].blockBuffer)),delete this.files[a].blockBuffer,this.files[a].blockBuffer=[]):c.resolve(this.files[a].fileSystemUrl),c.promise)},this.getFileEntry=function(a){return this.files[a].fileEntry},this.generateFileIdentifier=function(b,c){return a.crc32(b+c)}}])}(),function(){angular.module("peering",[]).service("peeringService",["config","$q","randomService",function(a,b,c){this.peer=null,this.getPeer=function(){var d,e=b.defer();if(null!==this.peer)return e.resolve(this.peer),e.promise;var f=new Peer(c.generateString(a.peerIdLength),a.peerConfig);return f.on("open",function(a){clearInterval(d),e.resolve(f)}),f.on("error",function(a){clearInterval(d),e.reject(a)}),d=setTimeout(function(){e.reject()},"undefined"==typeof a.peerConfig.timeout?1e4:a.peerConfig.timeout),this.peer=f,e.promise}}])}(),function(){"use strict";angular.module("static").directive("reepioSlidingFile",["$document",function(a){return{restrict:"EA",template:'<div class="sliding-file" data-ng-class="{ \'is-sliding\': scrollTop > .05 && scrollTop < 0.95, \'is-static\': scrollTop >= 1 }"><span class="fa fa-file"></span></div>',scope:{scrollMax:"=?"},link:function(b,c,d){angular.element(c);b.isSliding=!1,b.scrollMax=b.scrollMax||100,a.on("scroll",function(c){b.$apply(function(){b.scrollTop=a.scrollTop()/b.scrollMax})})}}}])}(),function(){"use strict";angular.module("static").config(["$routeProvider",function(a){a.when("/about",{templateUrl:"modules/static/page-about.html",controller:"StaticCtrl"}).when("/imprint",{templateUrl:"modules/static/page-imprint.html",controller:"StaticCtrl"}).when("/privacy",{templateUrl:"modules/static/page-privacy.html",controller:"StaticCtrl"}).when("/incompatible",{templateUrl:"modules/static/page-incompatible.html",controller:"StaticCtrl"})}]).controller("StaticCtrl",["$analytics","$location",function(a,b){a.pageTrack(b.path())}])}(),function(){"use strict";angular.module("titleController",["fileFilters"]).controller("TitleController",["$scope","$rootScope","$element","$filter",function(a,b,c,d){var e,f=" | ",g=function(a,b,e){var g=d("humanFileSize")(b);c.html(Math.round(e)+"%"+f+g+"/s"+f+"reep.io")},h=[b.$on("DownloadStateChanged",function(a,d){"undefined"!=typeof a&&("inprogress"===d?e=b.$on("intervalCalculations",g):("undefined"!=typeof e&&e(),c.html("reep.io"+f+"peer-to-peer filesharing made easy")))})];a.$on("$destroy",function(a){angular.forEach(h,function(a){a()})})}])}(),function(){"use strict";angular.module("upload").directive("p2mDropZone",["$animate","$document",function(a,b){function c(b,c,e){for(var f=c.length<b.maxFiles?c.length:b.maxFiles,g=0;f>g;g++){var h=c[g];if(h.size>1048576)d(b,h,e);else{var i=new FileReader;i.onload=function(a){d(b,a,e)}.bind(null,h),i.onerror=function(){b.files.length>0&&a.addClass(e,"ng-hide")},i.readAsArrayBuffer(h)}}}function d(b,c,d){c={rawFile:c,fileId:null,clients:{},totalDownloads:0,password:""},b.files.unshift(c),b.files.length>b.maxFiles&&b.files.pop(),a.addClass(d,"ng-hide"),b.$apply()}return{restrict:"A",scope:{files:"=",maxFiles:"=?"},link:function(d,e){var f=angular.element(e);return d.maxFiles=d.maxFiles||5,b.bind("dragover",function(b){b.stopPropagation(),b.preventDefault(),
a.removeClass(e,"ng-hide")}),b.bind("dragleave",function(b){b.stopPropagation(),b.preventDefault(),d.files.length>0&&a.addClass(e,"ng-hide")}),f.after('<input type="file" style="display: none" multiple>'),f.next().on("change",function(){c(d,this.files)}),f.on("click",function(){f.next().trigger("click")}),b.bind("drop",function(b){b.stopPropagation(),b.preventDefault(),a.addClass(e,"ng-hide");var f=b.originalEvent.dataTransfer.files||[];return c(d,f,e),b.preventDefault(),!1})}}}])}(),function(){"use strict";angular.module("upload").config(["$routeProvider",function(a){a.when("/",{templateUrl:"modules/upload/upload.html",controller:"UploadCtrl"})}]).controller("UploadCtrl",["$scope","$location","$timeout","$document","$analytics","$modal","uploadService","$rootScope","detectCrawlerService","$crypto",function(a,b,c,d,e,f,g,h,i,j){if(e.pageTrack(b.path()),!i.isCrawler(navigator.userAgent)&&!util.supports.data)return void b.path("incompatible");void 0===h.fileModel&&(h.fileModel={},h.fileModel.files=[]);var k=!0;a.onClipboardCopied=function(a){a=angular.element(a).find(".btn-clipboard-label"),a.tooltip("enable"),a.tooltip("show"),a.on("shown.bs.tooltip",function(){setTimeout(function(){a.tooltip("hide"),a.tooltip("disable")},500)})},a.$watchCollection("fileModel.files",function(a,d){if(k)return void c(function(){k=!1});if(a.length>d.length){var e=a[0];g.registerFile(e.rawFile).then(function(a){e.fileId=a.fileId,e.uniqueUrl=b.absUrl()+"d/"+a.peerId+a.fileId},function(a){})}else g.unregisterFile(d[0].fileId)}),a.getIsFileDropped=function(){return h.fileModel.files.length>0},a.addFile=function(){$("#drop-box").next().trigger("click")},a.removeFile=function(a){for(var b=0;b<h.fileModel.files.length;b++)if(h.fileModel.files[b].uniqueUrl===a){h.fileModel.files.splice(b,1);break}},a.lockFile=function(b){a.modalDialogFile=b;var c=f.open({templateUrl:"modules/upload/modals/password.html",controller:["$scope",function(a){a.input={},a.input.password=b.password,a.ok=function(){a.$close(a.input.password)},a.close=function(){a.$dismiss("cancel")},a.clear=function(){a.$dismiss("cancel")}}]});c.result.then(function(a){g.setPasswordForFile(b.fileId,a),b.password=a})["catch"](function(){g.setPasswordForFile(b.fileId,""),b.password=""})};var l=[h.$on("UploadStart",function(b,c,d){a.$apply(function(){for(var b=0;b<a.fileModel.files.length;++b)if(a.fileModel.files[b].fileId==d){a.fileModel.files[b].clients[c]={progress:0,speed:0};break}})}),h.$on("UploadProgress",function(b,c,d,e,f){a.$apply(function(){for(var b=0;b<a.fileModel.files.length;++b)if(a.fileModel.files[b].fileId==d&&void 0!==a.fileModel.files[b].clients[c]){a.fileModel.files[b].clients[c].progress=e,a.fileModel.files[b].clients[c].speed=f;break}})}),h.$on("UploadFinished",function(b,c,d){a.$apply(function(){for(var b=0;b<a.fileModel.files.length;++b)if(a.fileModel.files[b].fileId==d){delete a.fileModel.files[b].clients[c],a.fileModel.files[b].totalDownloads++;break}})}),h.$on("dataChannelClose",function(b,c,d){for(var e=0;e<h.fileModel.files.length;++e){h.fileModel.files[e].fileId==d&&delete h.fileModel.files[e].clients[c];break}a.$$phase||a.$apply(0)})],m=$.paste().appendTo("body");m.on("pasteImage",function(b,c){a.$apply(function(){var a=atob(c.dataURL.split(",")[1]),b=c.dataURL.split(",")[0].split(":")[1].split(";")[0];if(!(null===a||a.length<=0||null===b||b.length<=0)){for(var d=new ArrayBuffer(a.length),e=new Uint8Array(d),f=0;f<a.length;f++)e[f]=a.charCodeAt(f);var g="png";("image/jpeg"==b||"image/pjpeg"==b)&&(g="jpg"),h.fileModel.files.unshift({fileId:null,clients:{},totalDownloads:0,password:"",rawFile:{name:"Clipbboard Image "+new Date+"."+g,size:a.length,type:b,blobData:new Blob([d],{type:b})}}),delete c.dataURL}})}),m.focus(),$("body").get(0).onpaste=function(a){m.focus()},a.$on("$destroy",function(a){m.remove(),angular.forEach(l,function(a){a()})})}])}(),function(){angular.module("upload").service("uploadService",["config","$q","peeringService","randomService","$rootScope",function(a,b,c,d,e){this.uploads={},this.registerFile=function(a){return c.getPeer().then(function(b){var c=this.__generateFileId();return this.uploads[c]={},this.uploads[c].file=a,this.uploads[c].connections={},this.uploads[c].password="",b._events.hasOwnProperty("connection")||b.on("connection",function(a){a.on("data",function(b){if(this.hasOwnProperty("__onPacket"+b.packet)===!1||"function"!=typeof this["__onPacket"+b.packet])return void a.close();var c=this["__onPacket"+b.packet];(c=c.bind(this))(b,a)}.bind(this)),a.on("close",function(){e.$emit("dataChannelClose",a.peer,c)})}.bind(this)),{peerId:b.id,fileId:c,peer:b}}.bind(this))},this.unregisterFile=function(a){var b=this.uploads[a];if("undefined"==typeof b)throw new Error("No file registered with id "+a);angular.forEach(b.connections,function(a,c){a.__conn.close(),b.connections[c]=null})},this.__generateFileId=function(){for(var b=d.generateString(a.fileIdLength);this.uploads.hasOwnProperty(b);)b=d.generateString(a.fileIdLength);return b},this.setPasswordForFile=function(a,b){this.uploads[a].password=b},this.parseId=function(b){return b.hasOwnProperty("peerId")?b:{peerId:b.substring(0,a.peerIdLength),fileId:b.substring(a.peerIdLength,a.peerIdLength+a.fileIdLength)}},this.__onPacketDownloadFinished=function(a,b){e.$emit("UploadFinished",b.peer,a.fileId)},this.__onPacketAuthenticate=function(a,b){a.password===this.uploads[a.fileId].password?(this.uploads[a.fileId].connections[b.peer].isAuthenticated=!0,b.send({packet:"FileInformation",fileId:a.fileId,fileName:this.uploads[a.fileId].file.name,fileSize:this.uploads[a.fileId].file.size,fileType:this.uploads[a.fileId].file.type}),b.send({packet:"AuthenticationSuccessfull"})):b.send({packet:"IncorrectPassword"})},this.__onPacketRequestFileInformation=function(a,b){var c=this.uploads[a.fileId];"undefined"==typeof c.connections[b.peer]&&(c.connections[b.peer]={},c.connections[b.peer].isAuthenticated=c.password.length<=0,c.connections[b.peer].__conn=b),c.connections[b.peer].isAuthenticated?b.send({packet:"FileInformation",fileId:a.fileId,fileName:this.uploads[a.fileId].file.name,fileSize:this.uploads[a.fileId].file.size,fileType:this.uploads[a.fileId].file.type}):b.send({packet:"AuthenticationRequest"})},this.__onPacketRequestBlock=function(b,c){var d=this.uploads[b.fileId].connections[c.peer];if(0!=d.isAuthenticated){void 0===d.reader&&(e.$emit("UploadStart",c.peer,b.fileId),d.uploadedChunksSinceLastCalculate=0,d.reader=new FileReader,d.reader.onloadend=function(e){if(e.target.readyState==FileReader.DONE){if(0==e.target.result.byteLength)return;if(c.send(e.target.result),d.uploadedChunksSinceLastCalculate++,d.chunksToSend--,0==d.chunksToSend)return;if(d.startByte+=a.chunkSize,void 0!==this.uploads[b.fileId].file.blobData)var g=this.uploads[b.fileId].file.blobData.slice(d.startByte,d.startByte+a.chunkSize);else var g=this.uploads[b.fileId].file.slice(d.startByte,d.startByte+a.chunkSize);f.readAsArrayBuffer(g)}}.bind(this));var f=d.reader;d.startByte=b.chunkPosition*a.chunkSize,d.chunksToSend=a.chunksPerBlock;var g;g=void 0!==this.uploads[b.fileId].file.blobData?this.uploads[b.fileId].file.blobData.slice(d.startByte,d.startByte+a.chunkSize):this.uploads[b.fileId].file.slice(d.startByte,d.startByte+a.chunkSize),f.readAsArrayBuffer(g)}},this.__onPacketDownloadProgress=function(a,b){e.$emit("UploadProgress",b.peer,a.fileId,a.percent,a.bytesPerSecond)}}])}();